(()=>{var T=(()=>{let r=i=>String(i).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),p=(i,f)=>{let g=null;g=setTimeout(()=>{i(),clearTimeout(g),g=null},f)};return{copy:async(i,f=null,g=1500)=>{let B=i.getAttribute("data-copy");if(!B||B.length==0){alert("Nothing to copy");return}i.disabled=!0;try{await navigator.clipboard.writeText(B)}catch{i.disabled=!1,alert("Failed to copy");return}let m=i.innerHTML;i.innerHTML=f||'<i class="fa-solid fa-check"></i>',p(()=>{i.disabled=!1,i.innerHTML=m},g)},timeOut:p,escapeHtml:r,base64Encode:i=>{let g=new TextEncoder().encode(i);return window.btoa(String.fromCharCode(...g))},base64Decode:i=>{let f=new TextDecoder,g=Uint8Array.from(window.atob(i),B=>B.charCodeAt(0));return f.decode(g)},disableButton:(i,f="Loading")=>{i.disabled=!0;let g=i.innerHTML;return i.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${f}`,{restore:()=>{i.innerHTML=g,i.disabled=!1}}},disableCheckbox:i=>{i.disabled=!0;let f=document.querySelector(`label[for="${i.id}"]`),g=f.innerHTML;return f.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${g}`,{restore:()=>{f.innerHTML=g,i.disabled=!1}}},parseUserAgent:i=>{let f=[{type:"Mobile",regex:/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],g=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],B=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],m=f.find(L=>L.regex.test(i))?.type||"Unknown",k=g.find(L=>L.regex.test(i))?.name||"Unknown",n=B.find(L=>L.regex.test(i)),u=n&&i.match(n.regex)?.[1]?.replace(/_/g,".")||"",v=n?n.name:"Unknown";return u=u?`${v} ${u}`:v,`${k} ${m} ${u}`}}})();var I=(()=>{let r=(m,k,n)=>({code:m,data:k,error:n}),p=(m=0)=>({love:m}),b=({uuid:m,own:k,name:n,presence:u,comment:v,created_at:L,is_admin:S,ip:a,user_agent:t,comments:w,like:e})=>({uuid:m,own:k,name:n,presence:u,comment:v,created_at:L,is_admin:S??!1,ip:a,user_agent:t,comments:w?.map(b)??[],like:p(e?.love??0)});return{uuidResponse:({uuid:m})=>({uuid:m}),baseResponse:r,tokenResponse:({token:m})=>({token:m}),statusResponse:({status:m})=>({status:m}),commentResponse:({name:m,presence:k,comment:n,is_admin:u,created_at:v})=>({name:m,presence:k,comment:n,is_admin:u,created_at:v}),likeCommentResponse:p,getCommentResponse:b,getCommentsResponse:m=>m.map(b),commentShowMore:(m,k=!1)=>({uuid:m,show:k}),postCommentRequest:(m,k,n,u)=>({id:m,name:k,presence:n,comment:u}),postSessionRequest:(m,k)=>({email:m,password:k}),updateCommentRequest:(m,k)=>({presence:m,comment:k})}})();var $=r=>{let p=(l=null)=>{let y=JSON.parse(localStorage.getItem(r));return l?y[String(l)]:y},b=(l,y)=>{let i=p();i[String(l)]=y,localStorage.setItem(r,JSON.stringify(i))},d=l=>Object.keys(p()).includes(String(l)),o=l=>{if(!d(l))return;let y=p();delete y[String(l)],localStorage.setItem(r,JSON.stringify(y))},c=()=>localStorage.setItem(r,"{}");return localStorage.getItem(r)||c(),{set:b,get:p,has:d,clear:c,unset:o}};var O="GET",J="PUT",U="POST",D="PATCH",W="DELETE",A=(r,p)=>{let b=document.body.getAttribute("data-url"),d={method:String(r).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return b.slice(-1)==="/"&&(b=b.slice(0,-1)),{send(o=null){return fetch(b+p,d).then(c=>c.json().then(l=>{if(c.status>=500&&(l.message??l[0]))throw new Error(l.message??l[0]);if(l.error)throw new Error(l.error[0]);return o&&(l.data=o(l.data)),I.baseResponse(l.code,l.data,l.error)})).catch(c=>{throw alert(c),new Error(c)})},download(){return fetch(b+p,d).then(o=>{if(o.status!==200)return!1;let c=document.querySelector("a[download]");c&&document.body.removeChild(c);let l=o.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return o.blob().then(y=>{let i=document.createElement("a"),f=window.URL.createObjectURL(y);return i.href=f,i.download=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(f),!0})}).catch(o=>{throw alert(o),new Error(o)})},token(o){return o.split(".").length===3?(d.headers.append("Authorization","Bearer "+o),this):(d.headers.append("x-access-key",o),this)},body(o){return d.body=JSON.stringify(o),this}}};var x=(()=>{let r=null,p=()=>r.get("token"),b=f=>A(U,"/api/session").body(f).send(I.tokenResponse).then(g=>(g.code===200&&o(g.data.token),g.code===200),()=>!1),d=()=>r.unset("token"),o=f=>r.set("token",f),c=()=>String(p()??".").split(".").length===3;return{init:()=>{r=$("session")},guest:()=>A(O,"/api/config").token(p()).send().then(f=>{if(f.code!==200)return f;let g=$("config");for(let[B,m]of Object.entries(f.data))g.set(B,m);return f}),login:b,logout:d,decode:()=>{if(!c())return null;try{return JSON.parse(window.atob(p().split(".")[1]))}catch{return null}},isAdmin:c,setToken:o,getToken:p}})();var G=window.bootstrap;var j=(()=>{let r=null,p=async l=>{let y=T.disableButton(l),i=document.getElementById("loginEmail"),f=document.getElementById("loginPassword");i.disabled=!0,f.disabled=!0,await x.login(I.postSessionRequest(i.value,f.value))&&(i.value=null,f.value=null,G.Modal.getOrCreateInstance(document.getElementById("mainModal")).hide()),y.restore(),i.disabled=!1,f.disabled=!1},b=()=>A(O,"/api/user").token(x.getToken()).send().then(l=>{if(l.code!==200)return l;for(let[y,i]of Object.entries(l.data))r.set(y,i);return l},l=>(o(),l)),d=()=>r,o=()=>{r.clear(),x.logout(),G.Modal.getOrCreateInstance(document.getElementById("mainModal")).show()};return{init:()=>{r=$("user")},login:p,clearSession:o,getDetailUser:b,getUserStorage:d}})();var K=(()=>{let r=(d,o)=>{G.Tab.getOrCreateInstance(document.getElementById(o)).show(),d.classList.add("active"),document.querySelectorAll(".navbar button").forEach(c=>{c.classList.contains("active")&&c.classList.remove("active")})};return{buttonNavHome:d=>{r(d,"button-home")},buttonNavSetting:d=>{r(d,"button-setting")}}})();var F=(()=>{let r={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},p=["#ffffff","#f8f9fa"],b=["#000000","#212529"],d=!1,o=null,c=null,l=()=>o.set("active","light"),y=()=>o.set("active","dark"),i=()=>{l(),document.documentElement.setAttribute("data-bs-theme","light");let u=c.getAttribute("content");c.setAttribute("content",b.some(v=>v===u)?r[u]:u)},f=()=>{y(),document.documentElement.setAttribute("data-bs-theme","dark");let u=c.getAttribute("content");c.setAttribute("content",p.some(v=>v===u)?r[u]:u)},g=(u=null,v=null)=>{let L=o.get("active")==="dark";return u&&v?L?u:v:L};return{init:()=>{switch(o=$("theme"),c=document.querySelector('meta[name="theme-color"]'),o.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?y():l()),document.documentElement.getAttribute("data-bs-theme")){case"dark":y();break;case"light":l();break;default:d=!0}g()?f():i()},spyTop:()=>{let u=L=>{L.filter(S=>S.isIntersecting).forEach(S=>{let a=S.target.classList.contains("bg-white-black")?g(b[0],p[0]):g(b[1],p[1]);c.setAttribute("content",a)})},v=new IntersectionObserver(u,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(L=>v.observe(L))},change:()=>g()?i():f(),isDarkMode:g,isAutoMode:()=>d}})();var X=(()=>{let r=null,p=!0,b=m=>new Promise(k=>{let n=parseFloat(r.style.opacity),u=null,v=m?.05:-.05,L=m?1:0;u=setInterval(()=>{n=Math.max(0,Math.min(1,n+v)),r.style.opacity=n.toFixed(2),n===L&&(k(),clearInterval(u),u=null)},10)}),d=()=>{let m=null;m=setTimeout(()=>{clearTimeout(m),m=null,p&&l()},3e3)},o=()=>{let m=r.firstElementChild.firstElementChild;m.classList.remove("bg-success"),m.classList.add("bg-danger"),m.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},c=()=>{let m=r.firstElementChild.firstElementChild;m.classList.remove("bg-danger"),m.classList.add("bg-success"),m.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},l=async()=>{await b(!1),o()},y=()=>{let m=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"].join(", ");document.querySelectorAll(m).forEach(k=>{k.dispatchEvent(new Event(g()?"online":"offline")),k.setAttribute("data-offline-disabled",g()?"false":"true"),k.tagName==="BUTTON"?g()?k.classList.remove("disabled"):k.classList.add("disabled"):g()?k.removeAttribute("disabled"):k.setAttribute("disabled","true")})},i=()=>{p=!1,o(),b(!0),y()},f=()=>{p=!0,c(),d(),y()},g=()=>p;return{init:()=>{window.addEventListener("online",f),window.addEventListener("offline",i),r=document.getElementById("offline-mode"),r.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:g}})();var R=(()=>{let r=null,p=null,b=null,d=null,o=null,c=null,l=250,y=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,i=e=>([["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']].forEach(h=>{let E=h[0],M=h[1];e=e.replace(new RegExp(`\\${E}(?=\\S)(.*?)(?<!\\s)\\${E}`,"gs"),M)}),e),f=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.like(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${b.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,g=e=>{let s=`<div class="d-flex flex-wrap justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(d.get("can_reply")==!0||d.get("can_reply")===void 0)&&(s+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),p.has(e.uuid)&&(d.get("can_edit")==!0||d.get("can_edit")===void 0)&&(s+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),x.isAdmin()?s+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:p.has(e.uuid)&&(d.get("can_delete")==!0||d.get("can_delete")===void 0)&&(s+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),s+="</div>",s},B=(e,s)=>{let h=c.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${s.join(",")}" data-show="${h?"true":"false"}" role="button" class="me-auto ms-1 py-0">${h?"Hide replies":`Show replies (${s.length})`}</a>`},m=e=>`
        <div class="d-flex flex-wrap justify-content-between align-items-center" id="button-${e.uuid}">
            ${g(e)}
            ${e.comments.length>0?B(e.uuid,e.comments.map(s=>s.uuid)):""}
            ${f(e)}
        </div>`,k=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(e.ip)} ${o.has(e.ip)?`<strong>${o.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${T.parseUserAgent(T.escapeHtml(e.user_agent))}</p>
        </div>`,n=(e,s)=>s?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${c.get("hidden").find(h=>h.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,u=(e,s)=>e.is_admin?`<strong class="me-1">${T.escapeHtml(r.get("name")??d.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:s?`<strong class="me-1">${T.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${T.escapeHtml(e.name)}</strong>`,v=(e,s)=>{let h=F.isDarkMode("light","dark"),E=i(T.escapeHtml(e.comment)),M=E.length>l;return`
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${u(e,s)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${M?`data-comment="${T.base64Encode(E)}"`:""} id="content-${e.uuid}">${M?E.slice(0,l)+"...":E}</p>
        ${M?`<p class="mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},L=(e,s)=>`
        <div ${n(e,s)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">
            ${v(e,s)}
            </div>
            ${k(e)}
            ${m(e)}
            <div id="reply-content-${e.uuid}">${e.comments.map(h=>S(h)).join("")}</div>
        </div>`,S=e=>L(e,!1);return{init:()=>{r=$("user"),p=$("owns"),b=$("likes"),d=$("config"),o=$("tracker"),c=$("comment")},renderEdit:(e,s)=>{let h=document.createElement("div");return h.classList.add("my-2"),h.id=`inner-${e}`,h.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</label>
        ${document.getElementById(e).getAttribute("data-parent")==="true"&&!x.isAdmin()?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${s?"selected":""}>Datang</option>
            <option value="2" ${s?"":"selected"}>Berhalangan</option>
        </select>`:""}
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,h},renderReply:e=>{let s=document.createElement("div");return s.classList.add("my-2"),s.id=`inner-${e}`,s.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</label>
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,s},renderLoading:y,renderReadMore:B,renderInnerContent:S,renderContent:e=>L(e,!0),convertMarkdownToHTML:i,maxCommentLength:l}})();var ee=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var Y=r=>{if(!window.confetti)return;let p=Date.now()+25,b=Math.max(.3,Math.min(1,r.getBoundingClientRect().top/window.innerHeight+.2)),d=ee(),o=["#FF69B4","#FF1493"];(function c(){o.forEach(l=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[d],origin:{x:0,y:b},zIndex:1057,colors:[l]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[d],origin:{x:1,y:b},zIndex:1057,colors:[l]})}),Date.now()<p&&requestAnimationFrame(c)})()};var V=(()=>{let r=null,p=async o=>{let c=o.firstElementChild,l=o.lastElementChild,y=o.getAttribute("data-uuid"),i=parseInt(c.getAttribute("data-count-like"));o.disabled=!0,r.has(y)?await A(D,"/api/comment/"+r.get(y)).token(x.getToken()).send(I.statusResponse).then(f=>{f.data.status&&(r.unset(y),l.classList.remove("fa-solid","text-danger"),l.classList.add("fa-regular"),c.setAttribute("data-count-like",String(i-1)))}):await A(U,"/api/comment/"+y).token(x.getToken()).send(I.uuidResponse).then(f=>{f.code==201&&(r.set(y,f.data.uuid),l.classList.remove("fa-regular"),l.classList.add("fa-solid","text-danger"),c.setAttribute("data-count-like",String(i+1)))}),c.innerText=c.getAttribute("data-count-like"),o.disabled=!1};return{init:()=>{r=$("likes")},like:p,tapTap:async o=>{if(!navigator.onLine)return;let c=Date.now(),l=c-parseInt(o.getAttribute("data-tapTime")),y=o.id.replace("body-content-",""),i=l<300&&l>0,f=!r.has(y)&&o.getAttribute("data-liked")!=="true";if(i&&f){navigator.vibrate&&navigator.vibrate(100),Y(o);let g=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${y}"]`);o.setAttribute("data-liked","true"),await p(g),o.setAttribute("data-liked","false")}o.setAttribute("data-tapTime",c)}}})();var _=(()=>{let r=10,p=0,b=0,d=null,o=null,c=null,l=null,y=e=>{r=Number(e)},i=()=>r,f=()=>p,g=()=>b,B=()=>o.classList.contains("disabled")?null:o.classList.add("disabled"),m=()=>o.classList.contains("disabled")?o.classList.remove("disabled"):null,k=()=>c.classList.contains("disabled")?null:c.classList.add("disabled"),n=()=>c.classList.contains("disabled")?c.classList.remove("disabled"):null,u=()=>{l.classList.contains("d-none")&&l.classList.remove("d-none")},v=e=>{e.disabled=!0;let s=e.innerHTML;e.innerHTML='<span class="spinner-border spinner-border-sm my-0 mx-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>';let h=async()=>{await N.comment(),e.disabled=!1,e.innerHTML=s,N.scroll()};return{next:async()=>{p+=r,e.innerHTML="Next"+e.innerHTML,await h(),d.innerText=String(parseInt(d.innerText)+1)},prev:async()=>{p-=r,e.innerHTML=e.innerHTML+"Prev",await h(),d.innerText=String(parseInt(d.innerText)-1)}}};return{init:()=>{l=document.getElementById("pagination"),l.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,d=document.getElementById("page"),o=document.getElementById("previous"),c=document.getElementById("next")},setPer:y,getPer:i,getNext:f,reset:async()=>p===0?!1:(p=0,b=0,d.innerText=1,k(),B(),await N.comment(),!0),setResultData:e=>{if(b=e,p>0&&m(),b<r){k();return}n(),u()},getResultData:g,previous:async e=>{B(),!(p<0)&&(k(),await v(e).prev())},next:async e=>{k(),!(b<r)&&(B(),await v(e).next())}}})();var N=(()=>{let r=null,p=null,b=null,d=null,o=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',c=(a,t)=>{document.querySelector(`[data-button-action="${a}"]`).childNodes.forEach(w=>{w.disabled=t})},l=async a=>{if(!confirm("Are you sure?"))return;let t=a.getAttribute("data-uuid");x.isAdmin()&&r.set(t,a.getAttribute("data-own")),c(t,!0);let w=T.disableButton(a),e=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`);if(e.disabled=!0,!await A(W,"/api/comment/"+r.get(t)).token(x.getToken()).send(I.statusResponse).then(E=>E.data.status,()=>!1)){w.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(E=>{let M=E.getAttribute("data-uuids").split(",");if(M.find(q=>q===t)){let q=M.filter(C=>C!==t).join(",");q.length===0?E.remove():E.setAttribute("data-uuids",q)}}),r.unset(t),document.getElementById(t).remove();let h=document.getElementById("comments");h.children.length==0&&(h.innerHTML=o())},y=async a=>{let t=a.getAttribute("data-uuid"),w=!1,e=document.getElementById(`form-inner-presence-${t}`);e&&(e.disabled=!0,w=e.value==="1");let s=document.getElementById(`form-${t?`inner-${t}`:"comment"}`),h=!1,E=document.getElementById(`badge-${t}`);if(E&&(h=E.classList.contains("text-success")),t&&T.base64Encode(s.value)===s.getAttribute("data-original")&&h===w){c(t,!1),document.getElementById(`inner-${t}`).remove();return}s.disabled=!0;let M=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);M&&(M.disabled=!0);let q=T.disableButton(a),C=await A(J,"/api/comment/"+r.get(t)).token(x.getToken()).body(I.updateCommentRequest(e?w:null,s.value)).send(I.statusResponse).then(Z=>Z.data.status,()=>!1);if(s.disabled=!1,M&&(M.disabled=!1),e&&(e.disabled=!1),q.restore(),!C)return;c(t,!1),document.getElementById(`inner-${t}`).remove();let P=document.querySelector(`[onclick="undangan.comment.showMore(this, '${t}')"]`),H=R.convertMarkdownToHTML(T.escapeHtml(s.value)),z=document.getElementById(`content-${t}`);if(H.length>R.maxCommentLength?(z.innerHTML=P?.getAttribute("data-show")==="false"?H.slice(0,R.maxCommentLength)+"...":H,z.setAttribute("data-comment",T.base64Encode(H)),P?.style.display==="none"&&(P.style.display="block")):(z.innerHTML=H,z.removeAttribute("data-comment"),P?.style.display==="block"&&(P.style.display="none")),e&&(document.getElementById("form-presence").value=w?"1":"2",$("information").set("presence",w)),!(!e||!E)){if(w){E.classList.remove("fa-circle-xmark","text-danger"),E.classList.add("fa-circle-check","text-success");return}E.classList.remove("fa-circle-check","text-success"),E.classList.add("fa-circle-xmark","text-danger")}},i=async a=>{let t=a.getAttribute("data-uuid"),w=document.getElementById("form-name"),e=w.value;if(x.isAdmin()&&(e=p.get("name")),e.length==0){t&&w.scrollIntoView({behavior:"smooth"}),alert("Silakan masukkan nama Anda.");return}let s=document.getElementById("form-presence");if(!t&&s&&s.value=="0"){alert("Silakan pilih status kehadiran Anda.");return}!t&&w&&!x.isAdmin()&&(w.disabled=!0),s&&s.value!="0"&&(s.disabled=!0);let h=document.getElementById(`form-${t?`inner-${t}`:"comment"}`);h.disabled=!0;let E=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);E&&(E.disabled=!0);let M=T.disableButton(a),q=s?s.value==="1":!0;if(!x.isAdmin()){let P=$("information");P.set("name",e),t||P.set("presence",q)}let C=await A(U,"/api/comment").token(x.getToken()).body(I.postCommentRequest(t,e,q,h.value)).send(I.getCommentResponse).then(P=>P,()=>null);if(w&&(w.disabled=!1),h.disabled=!1,E&&(E.disabled=!1),s&&(s.disabled=!1),M.restore(),!(!C||C.code!==201)){if(r.set(C.data.uuid,C.data.own),h.value=null,!t){if(await _.reset()){L();return}C.data.is_admin=x.isAdmin();let H=document.getElementById("comments");_.setResultData(H.children.length),_.getResultData()==_.getPer()&&H.lastElementChild.remove(),H.innerHTML=R.renderContent(C.data)+H.innerHTML,L()}if(t){d.set("hidden",d.get("hidden").concat([I.commentShowMore(C.data.uuid,!0)])),d.set("show",d.get("show").concat([t])),c(t,!1),document.getElementById(`inner-${t}`).remove(),C.data.is_admin=x.isAdmin(),document.getElementById(`reply-content-${t}`).insertAdjacentHTML("beforeend",R.renderInnerContent(C.data));let P=document.getElementById(`button-${t}`),H=P.querySelector("a"),z=[C.data.uuid];H&&(H.getAttribute("data-show")==="false"&&k(H),H.remove()),P.querySelector(`button[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`).insertAdjacentHTML("beforebegin",R.renderReadMore(t,H?H.getAttribute("data-uuids").split(",").concat(z):z))}u(C.data)}},f=a=>{let t=document.getElementById(`form-inner-${a}`),w=!1,e=document.getElementById(`form-inner-presence-${a}`);e&&(w=e.value==="1");let s=!1,h=document.getElementById(`badge-${a}`);h&&(s=h.classList.contains("text-success")),(t.value.length===0||T.base64Encode(t.value)===t.getAttribute("data-original")&&s===w||confirm("Are you sure?"))&&(c(a,!1),document.getElementById(`inner-${a}`).remove())},g=a=>{let t=a.getAttribute("data-uuid");document.getElementById(`inner-${t}`)||(c(t,!0),document.getElementById(`button-${t}`).insertAdjacentElement("afterend",R.renderReply(t)))},B=async a=>{let t=a.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;c(t,!0);let w=T.disableButton(a);await A(O,"/api/comment/"+t).token(x.getToken()).send(I.commentResponse).then(e=>{if(e.code!==200)return;document.getElementById(`button-${t}`).insertAdjacentElement("afterend",R.renderEdit(t,e.data.presence));let s=document.getElementById(`form-inner-${t}`);s.value=e.data.comment,s.setAttribute("data-original",T.base64Encode(e.data.comment))}),w.restore(),a.disabled=!0},m=()=>{let a=document.getElementById("comments");return a.getAttribute("data-loading")==="false"&&(a.setAttribute("data-loading","true"),a.innerHTML=R.renderLoading().repeat(_.getPer())),A(O,`/api/comment?per=${_.getPer()}&next=${_.getNext()}`).token(x.getToken()).send(I.getCommentsResponse).then(t=>{if(_.setResultData(t.data.length),a.setAttribute("data-loading","false"),t.data.length===0)return a.innerHTML=o(),t;let w=(e,s)=>(e.forEach(h=>{s.find(E=>E.uuid===h.uuid)||s.push(I.commentShowMore(h.uuid)),h.comments&&h.comments.length>0&&w(h.comments,s)}),s);return d.set("hidden",w(t.data,d.get("hidden"))),a.innerHTML=t.data.map(e=>R.renderContent(e)).join(""),t.data.forEach(v),t.data.forEach(u),t})},k=a=>{let t=a.getAttribute("data-uuids").split(","),w=a.getAttribute("data-show")==="true",e=a.getAttribute("data-uuid");w?(a.setAttribute("data-show","false"),a.innerText="Show replies",a.innerText+=" ("+t.length+")",d.set("show",d.get("show").filter(s=>s!==e))):(a.setAttribute("data-show","true"),a.innerText="Hide replies",d.set("show",d.get("show").concat([e])));for(let s of t){d.set("hidden",d.get("hidden").map(E=>(E.uuid===s&&(E.show=!w),E)));let h=document.getElementById(s).classList;w?h.add("d-none"):h.remove("d-none")}},n=(a,t)=>{let w=document.getElementById(`content-${t}`),e=T.base64Decode(w.getAttribute("data-comment")),s=a.getAttribute("data-show")==="false";w.innerHTML=s?e:e.slice(0,R.maxCommentLength)+"...",a.innerText=s?"Sebagian":"Selengkapnya",a.setAttribute("data-show",s?"true":"false")},u=a=>{a.comments&&a.comments.forEach(u);let t=document.getElementById(`body-content-${a.uuid}`);t.addEventListener("touchend",()=>V.tapTap(t))},v=a=>{x.isAdmin()&&(a.comments&&a.comments.forEach(v),!(a.ip===void 0||a.user_agent===void 0||a.is_admin||b.has(a.ip))&&fetch(`https://freeipapi.com/api/json/${a.ip}`).then(t=>t.json()).then(t=>{let w=t.cityName+" - "+t.regionName;t.cityName=="-"&&t.regionName=="-"&&(w="localhost"),b.set(a.ip,w),document.getElementById(`ip-${a.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(a.ip)} <strong>${w}</strong>`}).catch(t=>{document.getElementById(`ip-${a.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(a.ip)} <strong>${T.escapeHtml(t.message)}</strong>`}))},L=()=>document.getElementById("comments").scrollIntoView({behavior:"smooth"});return{like:V,pagination:_,init:()=>{V.init(),R.init(),_.init(),r=$("owns"),p=$("user"),b=$("tracker"),d=$("comment"),d.has("hidden")||d.set("hidden",[]),d.has("show")||d.set("show",[])},scroll:L,cancel:f,send:i,edit:B,reply:g,remove:l,update:y,comment:m,showMore:n,showOrHide:k}})();var Q=(()=>{let r=async()=>{await j.getDetailUser().then(n=>{document.getElementById("dashboard-name").innerHTML=`${T.escapeHtml(n.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=n.data.email,document.getElementById("dashboard-accesskey").value=n.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",n.data.access_key),document.getElementById("form-name").value=T.escapeHtml(n.data.name),document.getElementById("filterBadWord").checked=!!n.data.is_filter,document.getElementById("replyComment").checked=!!n.data.can_reply,document.getElementById("editComment").checked=!!n.data.can_edit,document.getElementById("deleteComment").checked=!!n.data.can_delete}),A(O,"/api/stats").token(x.getToken()).send().then(n=>{document.getElementById("count-comment").innerHTML=String(n.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(n.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(n.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(n.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),N.comment()},p=async n=>{let u=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({filter:!!n.checked}).send(),u.restore()},b=async n=>{let u=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_reply:!!n.checked}).send(),u.restore()},d=async n=>{let u=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_edit:!!n.checked}).send(),u.restore()},o=async n=>{let u=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_delete:!!n.checked}).send(),u.restore()},c=async n=>{if(!confirm("Are you sure?"))return;let u=T.disableButton(n);await A(J,"/api/key").token(x.getToken()).send(I.statusResponse).then(v=>{v.data.status&&r()}),u.restore()},l=async n=>{let u=document.getElementById("old_password"),v=document.getElementById("new_password");if(u.value.length==0||v.value.length==0){alert("Password cannot be empty");return}u.disabled=!0,v.disabled=!0;let L=T.disableButton(n),S=await A(D,"/api/user").token(x.getToken()).body({old_password:u.value,new_password:v.value}).send(I.statusResponse).then(a=>a.data.status,()=>!1);L.restore(),u.disabled=!1,v.disabled=!1,S&&(u.value=null,v.value=null,n.disabled=!0,alert("Success change password"))},y=async n=>{let u=document.getElementById("form-name");if(u.value.length==0){alert("Name cannot be empty");return}u.disabled=!0;let v=T.disableButton(n),L=await A(D,"/api/user").token(x.getToken()).body({name:u.value}).send(I.statusResponse).then(S=>S.data.status,()=>!1);u.disabled=!1,v.restore(),L&&(r(),n.disabled=!0,alert("Success change name"))},i=async n=>{let u=T.disableButton(n);await A(O,"/api/download").token(x.getToken()).download(),u.restore()},f=()=>{let n=document.getElementById("button-change-name");n.disabled&&(n.disabled=!1)},g=()=>{let n=document.getElementById("button-change-password"),u=document.getElementById("old_password");n.disabled&&u.value.length!==0&&(n.disabled=!1)},B=()=>{confirm("Are you sure?")&&j.clearSession()},m=()=>{X.init(),x.isAdmin()||($("owns").clear(),$("likes").clear(),$("config").clear(),$("comment").clear(),$("session").clear(),$("information").clear()),F.spyTop(),N.init(),document.getElementById("mainModal").addEventListener("hidden.bs.modal",r);try{let n=x.decode()?.exp;if(!n||n<Date.now()/1e3)throw new Error("Invalid token");r()}catch{j.clearSession()}};return{init:()=>(j.init(),F.init(),x.init(),window.addEventListener("DOMContentLoaded",m),{util:T,theme:F,comment:N,admin:{auth:j,navbar:K,logout:B,download:i,regenerate:c,editComment:d,replyComment:b,deleteComment:o,changeName:y,changePassword:l,changeFilterBadWord:p,enableButtonName:f,enableButtonPassword:g}})}})();window.undangan=Q.init();})();
